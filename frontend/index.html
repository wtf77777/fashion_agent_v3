<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="AI 智慧衣櫥管理系統">
    <title>🌟 AI 時尚顧問</title>

    <!-- CSS -->
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="/static/css/upload.css">
    <link rel="stylesheet" href="/static/css/wardrobe.css">
    <link rel="stylesheet" href="/static/css/recommendation.css">
    <!-- ✅ 優先級 3：指定單品 CSS -->
    <link rel="stylesheet" href="/static/css/anchor-item.css">
</head>

<body>
    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="spinner"></div>
        <p>載入中...</p>
    </div>

    <!-- Top Navigation -->
    <nav class="top-nav">
        <div class="container">
            <div class="nav-brand">
                <h1>🌟 AI 時尚顧問</h1>
            </div>
            <div class="nav-user" id="user-info">
                <span id="username-display">未登入</span>
                <button id="logout-btn" class="btn btn-secondary" style="display: none;">
                    🚪 登出
                </button>
            </div>
        </div>
    </nav>

    <!-- Weather Widget -->
    <div id="weather-widget" class="weather-widget" style="display: none;">
        <div class="container">
            <div class="weather-content">
                <div class="weather-city">
                    <h3 id="weather-city-name">台北</h3>
                </div>
                <div class="weather-metrics">
                    <div class="metric">
                        <span class="metric-label">🌡️ 溫度</span>
                        <span class="metric-value" id="weather-temp">--°C</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">🤚 體感</span>
                        <span class="metric-value" id="weather-feels">--°C</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">☁️ 天氣</span>
                        <span class="metric-value" id="weather-desc">--</span>
                    </div>
                </div>
            </div>
            <p class="weather-update" id="weather-update-time"></p>
        </div>
    </div>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Login/Register Section -->
            <div id="auth-section" class="auth-section">
                <div class="auth-container">
                    <div class="auth-tabs">
                        <button class="tab-btn active" data-tab="login">🔒 登入</button>
                        <button class="tab-btn" data-tab="register">📝 註冊</button>
                    </div>

                    <!-- Login Form -->
                    <div id="login-tab" class="tab-content active">
                        <h2>登入帳號</h2>
                        <form id="login-form">
                            <div class="form-group">
                                <label for="login-username">使用者名稱</label>
                                <input type="text" id="login-username" required>
                            </div>
                            <div class="form-group">
                                <label for="login-password">密碼</label>
                                <input type="password" id="login-password" required>
                            </div>
                            <button type="submit" class="btn btn-primary">登入</button>
                        </form>
                    </div>

                    <!-- Register Form -->
                    <div id="register-tab" class="tab-content">
                        <h2>註冊新帳號</h2>
                        <form id="register-form">
                            <div class="form-group">
                                <label for="register-username">使用者名稱</label>
                                <input type="text" id="register-username" required>
                            </div>
                            <div class="form-group">
                                <label for="register-password">密碼</label>
                                <input type="password" id="register-password" required minlength="6">
                            </div>
                            <div class="form-group">
                                <label for="register-password2">確認密碼</label>
                                <input type="password" id="register-password2" required minlength="6">
                            </div>
                            <button type="submit" class="btn btn-primary">註冊</button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- App Content (Hidden until logged in) -->
            <div id="app-content" style="display: none;">
                <!-- Tab Navigation -->
                <div class="app-tabs">
                    <button class="app-tab-btn active" data-page="upload">
                        📸 上傳入庫
                    </button>
                    <button class="app-tab-btn" data-page="wardrobe">
                        👔 我的衣櫥
                    </button>
                    <button class="app-tab-btn" data-page="recommendation">
                        💡 今日推薦
                    </button>
                    <button class="app-tab-btn" data-page="profile">
                        ⚙️ 個人設定
                    </button>
                </div>

                <!-- Upload Page -->
                <div id="upload-page" class="page-content active">
                    <!-- 新增衣服上傳區 (固定頂部) -->
                    <section class="add-item-section">
                        <div class="card-glass">
                            <h3 class="card-title">新增衣服上傳</h3>

                            <div class="upload-controls">
                                <div class="upload-dropzone" id="upload-zone">
                                    <div class="plus-icon">＋</div>
                                    <button type="button" class="btn-ghost" id="select-btn">上傳照片</button>
                                    <input type="file" id="file-input" multiple accept="image/jpeg,image/png,image/jpg"
                                        style="display: none;">
                                </div>

                                <div class="settings-group">
                                    <select id="batch-warmth-select" class="warmth-select">
                                        <option value="" disabled selected>選擇厚薄程度</option>
                                        <option value="薄">極薄</option>
                                        <option value="適中">中等</option>
                                        <option value="厚">極厚</option>
                                    </select>
                                    <button id="add-to-queue-btn" class="btn-confirm">確認</button>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- 待上傳列表 (下方流動) -->
                    <section class="queue-section">
                        <div class="queue-actions">
                            <h3>📋 待上傳隊列 (<span id="queue-count">0</span>)</h3>
                        </div>
                        <div class="queue-grid" id="queue-grid">
                            <div class="queue-empty-msg">目前沒有等待上傳的衣服</div>
                        </div>

                        <!-- 底部執行按鈕 -->
                        <div class="batch-action-area" id="batch-action-area" style="display: none; margin-top: 30px;">
                            <button id="batch-upload-btn" class="btn-batch-upload">🚀 開始批量辨識並上傳全部</button>
                        </div>
                    </section>

                    <div class="info-box">
                        <h4>📌 使用提示:</h4>
                        <ul>
                            <li>拍攝清晰的單件衣服照片</li>
                            <li>背景簡潔有助於 AI 辨識</li>
                            <li>🚀 選取照片並設定厚度後按「確認」即可加入隊列</li>
                            <li>系統會自動過濾重複的衣服</li>
                        </ul>
                    </div>
                </div>

                <!-- Wardrobe Page -->
                <div id="wardrobe-page" class="page-content">
                    <h2>我的雲端衣櫥</h2>

                    <div class="wardrobe-actions">
                        <button id="refresh-wardrobe-btn" class="btn btn-secondary">
                            🔄 重新整理
                        </button>
                        <button id="batch-delete-btn" class="btn btn-secondary">
                            🗑️ 批量刪除
                        </button>
                        <button id="batch-cancel-btn" class="btn btn-secondary" style="display: none;">
                            取消
                        </button>
                    </div>

                    <!-- 分類過濾按鈕 -->
                    <div class="wardrobe-filters">
                        <button class="filter-btn active" data-filter="all">全部</button>
                        <button class="filter-btn" data-filter="上衣">上衣</button>
                        <button class="filter-btn" data-filter="下身">下身</button>
                        <button class="filter-btn" data-filter="外套">外套</button>
                        <button class="filter-btn" data-filter="鞋子">鞋子</button>
                        <button class="filter-btn" data-filter="配件">配件</button>
                    </div>

                    <div id="wardrobe-stats" class="stats-grid">
                        <div class="stat-card">
                            <span class="stat-label">總計</span>
                            <span class="stat-value" id="total-items">0</span>
                        </div>
                    </div>

                    <div id="wardrobe-grid" class="wardrobe-grid">
                        <!-- Items will be loaded here -->
                    </div>

                    <div id="wardrobe-empty" class="empty-state" style="display: none;">
                        <p>衣櫥是空的，去上傳一些衣服吧！ 👕</p>
                    </div>
                </div>

                <!-- Recommendation Page -->
                <div id="recommendation-page" class="page-content">
                    <h2>今日穿搭推薦</h2>

                    <div class="recommendation-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="city-select">🌍 選擇城市</label>
                                <select id="city-select">
                                    <option value="臺北市">臺北市</option>
                                    <option value="新北市">新北市</option>
                                    <option value="桃園市">桃園市</option>
                                    <option value="臺中市">臺中市</option>
                                    <option value="臺南市">臺南市</option>
                                    <option value="高雄市">高雄市</option>
                                    <option value="基隆市">基隆市</option>
                                    <option value="新竹市">新竹市</option>
                                    <option value="新竹縣">新竹縣</option>
                                    <option value="苗栗縣">苗栗縣</option>
                                    <option value="彰化縣">彰化縣</option>
                                    <option value="南投縣">南投縣</option>
                                    <option value="雲林縣">雲林縣</option>
                                    <option value="嘉義市">嘉義市</option>
                                    <option value="嘉義縣">嘉義縣</option>
                                    <option value="屏東縣">屏東縣</option>
                                    <option value="宜蘭縣">宜蘭縣</option>
                                    <option value="花蓮縣">花蓮縣</option>
                                    <option value="臺東縣">臺東縣</option>
                                    <option value="澎湖縣">澎湖縣</option>
                                    <option value="金門縣">金門縣</option>
                                    <option value="連江縣">連江縣</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="style-input">💫 想要什麼風格？</label>
                                <input type="text" id="style-input" placeholder="例如：日系簡約、美式復古...">
                                <small>留空則由 AI 自由發揮</small>
                            </div>
                            <div class="form-group">
                                <label for="occasion-input">📍 要去什麼場合/活動？</label>
                                <input type="text" id="occasion-input" placeholder="例如：公司開會、約會看電影...">
                                <small>預設為：外出遊玩</small>
                            </div>
                        </div>
                        <div class="form-row" style="gap: 10px; align-items: flex-end;">
                            <button id="get-recommendation-btn" class="btn btn-primary btn-large">
                                ✨ 獲取今日推薦
                            </button>
                            <!-- ✅ 優先級 3：指定單品按鈕 -->
                            <button id="anchor-item-btn" class="btn btn-secondary" style="position: relative;">
                                🔒 指定單品
                                <span id="anchor-count-badge" class="anchor-count-badge" style="display: none;">0</span>
                            </button>
                        </div>

                        <div id="recommendation-result" class="recommendation-result" style="display: none;">
                            <h3>🎨 今日穿搭建議</h3>
                            <div id="recommendation-text" class="recommendation-text"></div>

                            <h3>👔 推薦單品展示</h3>
                            <div id="recommendation-items" class="recommendation-carousel">
                                <!-- Items will be loaded here -->
                            </div>
                        </div>
                    </div>

                    
                </div>

<!-- Profile Page (Refactored to SPA) -->
                <div id="profile-page" class="page-content">
                    <div class="profile-container">
                        <div class="profile-header">
                            <h1>🌟 個人設定</h1>
                            <p>管理您的個人資料、風格偏好和推薦歷史紀錄</p>
                        </div>

                        <div class="profile-tabs">
                            <button class="profile-tab-btn active" data-tab="personal">👤 個人資料</button>
                            <button class="profile-tab-btn" data-tab="preferences">💫 偏好設定</button>
                            <button class="profile-tab-btn" data-tab="history">📜 推薦歷史</button>
                        </div>

                        <div class="profile-content">
                            <!-- 個人資料頁面 -->
                            <div id="personal" class="tab-page active">
                                <div class="form-section">
                                    <h3>👤 基本資訊</h3>
                                    <div class="form-row">
                                        <div class="profile-form-group">
                                            <label>性別</label>
                                            <select id="gender">
                                                <option value="">請選擇</option>
                                                <option value="male">男性</option>
                                                <option value="female">女性</option>
                                                <option value="other">其他</option>
                                            </select>
                                        </div>
                                        <div class="profile-form-group">
                                            <label>身高 (cm)</label>
                                            <input type="number" id="height" placeholder="例如：170">
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="profile-form-group">
                                            <label>體重 (kg)</label>
                                            <input type="number" id="weight" placeholder="例如：65">
                                        </div>
                                    </div>
                                </div>

                                <div class="form-section">
                                    <h3>🌡️ 體感偏好</h3>
                                    <div class="radio-group">
                                        <div class="radio-option">
                                            <input type="radio" id="cold" name="thermal" value="cold_sensitive">
                                            <label for="cold">怕冷 (會加件外套)</label>
                                        </div>
                                        <div class="radio-option">
                                            <input type="radio" id="normal" name="thermal" value="normal" checked>
                                            <label for="normal">正常</label>
                                        </div>
                                        <div class="radio-option">
                                            <input type="radio" id="hot" name="thermal" value="heat_sensitive">
                                            <label for="hot">怕熱 (儘量透氣)</label>
                                        </div>
                                    </div>
                                </div>

                                <button class="save-btn" onclick="ProfileUI.savePersonalInfo()">💾 儲存個人資料</button>
                            </div>

                            <!-- 偏好設定頁面 -->
                            <div id="preferences" class="tab-page">
                                <div class="form-section">
                                    <h3>💫 風格偏好</h3>
                                    <div class="form-row full">
                                        <div class="profile-form-group">
                                            <label>選擇風格</label>
                                            <div class="style-selector">
                                                <select id="style-select"
                                                    onchange="ProfileUI.showStyleDescription()">
                                                    <option value="">-- 選擇風格 --</option>
                                                    <option value="Minimalist">極簡 (Minimalist)</option>
                                                    <option value="Japanese Cityboy">日系 (Japanese Cityboy)</option>
                                                    <option value="Korean Chic">韓系 (Korean Chic)</option>
                                                    <option value="American Vintage">美式復古 (American Vintage)
                                                    </option>
                                                    <option value="Streetwear">街頭潮流 (Streetwear)</option>
                                                    <option value="Formal">正裝商務 (Formal)</option>
                                                    <option value="Athleisure">運動休閒 (Athleisure)</option>
                                                    <option value="French Chic">法式慵懶 (French Chic)</option>
                                                    <option value="Y2K">千禧復古 (Y2K)</option>
                                                    <option value="Old Money">老錢風 (Old Money)</option>
                                                    <option value="Bohemian">波西米亞 (Bohemian)</option>
                                                    <option value="Grunge">暗黑搖滾 (Grunge)</option>
                                                    <option value="Techwear">賽博機能 (Techwear)</option>
                                                    <option value="Coquette">甜美少女 (Coquette)</option>
                                                    <option value="Gorpcore">山系戶外 (Gorpcore)</option>
                                                </select>
                                                <button onclick="ProfileUI.addStyle()">新增</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="style-description" id="style-desc">選擇一個風格查看詳細描述</div>
                                    <div class="form-group">
                                        <label>您選擇的風格</label>
                                        <div class="style-list" id="favorite-styles-list">
                                            <!-- 動態生成 -->
                                        </div>
                                    </div>
                                </div>

                                <div class="form-section">
                                    <h3>🚫 避雷清單</h3>
                                    <div class="form-row full">
                                        <div class="profile-form-group">
                                            <label>不想穿的單品或風格 (用逗號分隔)</label>
                                            <textarea id="dislikes" placeholder="例如：短褲, 涼鞋, 碎花, 露肩..."></textarea>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-section">
                                    <h3>✍️ 自訂描述</h3>
                                    <div class="form-row full">
                                        <div class="profile-form-group">
                                            <label>關於您的風格 (給 AI 的建議)</label>
                                            <textarea id="custom-desc"
                                                placeholder="例如：我喜歡寬鬆的版型，經常穿大地色..."></textarea>
                                        </div>
                                    </div>
                                </div>

                                <button class="save-btn" onclick="ProfileUI.savePreferences()">💾 儲存偏好設定</button>
                            </div>

                            <!-- 推薦歷史頁面 -->
                            <div id="history" class="tab-page">
                                <div class="form-section">
                                    <h3>📜 推薦歷史紀錄</h3>
                                    <div id="history-list">
                                        <div class="empty-state">
                                            <p>暫無推薦記錄</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
    </main>

    <!-- Scroll to Top Button -->
    <button id="scroll-top-btn" class="scroll-top-btn" title="回到頂端">
        ⬆️
    </button>

    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <!-- Edit Item Modal (✅ Oreoooooo 新增) -->
    <div id="edit-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content card-glass">
            <div class="modal-header">
                <h3>📝 修改衣服資訊</h3>
                <button class="close-btn" onclick="WardrobeUI.closeEditModal()">×</button>
            </div>
            <form id="edit-form" class="modal-body">
                <input type="hidden" id="edit-item-id">
                <div class="form-group">
                    <label>衣服名稱</label>
                    <input type="text" id="edit-name">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>類別</label>
                        <select id="edit-category">
                            <option value="上衣">上衣</option>
                            <option value="下身">下身</option>
                            <option value="外套">外套</option>
                            <option value="鞋子">鞋子</option>
                            <option value="配件">配件</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>顏色</label>
                        <input type="text" id="edit-color">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>風格</label>
                        <input type="text" id="edit-style">
                    </div>
                    <div class="form-group">
                        <label>保暖度 (1-10)</label>
                        <input type="number" id="edit-warmth" min="1" max="10">
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="WardrobeUI.closeEditModal()">取消</button>
                    <button type="submit" class="btn btn-primary">💾 儲存修改</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ✅ 優先級 3：指定單品 Modal -->
    <div id="anchor-modal" class="anchor-modal">
        <div class="anchor-modal-content">
            <div class="anchor-modal-header">
                <h3 class="anchor-modal-title">🔒 指定今日單品</h3>
                <button class="anchor-modal-close" type="button">&times;</button>
            </div>

            <div id="anchor-wardrobe-list" class="anchor-wardrobe-list">
                <!-- 衣櫥單品卡片會在這裡渲染 -->
            </div>

            <div class="anchor-modal-footer">
                <button class="anchor-cancel-btn" type="button" onclick="AnchorItemUI.closeModal()">取消</button>
                <button id="anchor-confirm-btn" class="anchor-confirm-btn" type="button">✅ 確認指定</button>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/heic2any@0.0.4/dist/heic2any.min.js"></script>
    <script src="/static/js/api.js"></script>
    <script src="/static/js/upload.js"></script>
    <script src="/static/js/wardrobe.js"></script>
    <script src="/static/js/recommendation.js"></script>
    <!-- ✅ 優先級 3：指定單品 & 導購連結 JS -->
    <script src="/static/js/anchor-item.js"></script>
    <script src="/static/js/profile.js"></script>
    <script src="/static/js/app.js"></script>
</body>

</html>
